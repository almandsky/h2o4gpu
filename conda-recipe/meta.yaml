{% set setup_data = load_setup_py_data(setup_file="../src/interface_py/setup.py", from_recipe_dir=True) %}
{% set build_number = load_file_regex(load_file='src/interface_py/h2o4gpu/BUILD_INFO.txt', regex_pattern='suffix="\+(\w+)_.*"').group(1) %}
{% set commit = load_file_regex(load_file="src/interface_py/h2o4gpu/BUILD_INFO.txt", regex_pattern='commit="(\w+)"').group(1) %}
{% set build_date = load_file_regex(load_file='src/interface_py/h2o4gpu/BUILD_INFO.txt', regex_pattern='build_date="(\d+)"').group(1) %}
{% set py = 'py' ~ CONDA_PY %}
{% set platform = SUBDIR|replace('-','') %}
{% set build_string = platform ~ '_' ~ py ~ '_' ~ build_date ~ '_' ~ commit|truncate(9,end='') ~ '_' ~ build_number %}
{% set version = load_file_regex(load_file='src/interface_py/h2o4gpu/BUILD_INFO.txt', regex_pattern='base_version="([\d.]+)"').group(1) %}

package:
  name: "h2o4gpu"
  version: "{{ version }}"

source:
  path: ../

build:
  string: "{{ build_string }}"
  number: 0
  script_env:
    - HOME
    - CUDA_HOME
    - CUDADIR
    - PATH
    - LD_LIBRARY_PATH
    - OMP_NUM_THREADS
    - MKL_NUM_THREADSVECLIB_MAXIMUM_THREADS
    - LLVM4
    - LANG
    - LANGUAGE

requirements:
  build:
    - python {{ python }}
    {% for dep in setup_data['install_requires'] %}
    - {{ dep.lower() }}
    {% endfor %}
  run:
    - python {{ python }}
    {% for dep in setup_data['install_requires'] %}
    - {{ dep.lower() }}
    {% endfor %}

test:
  imports:
    - h2o4gpu

about:
  home: "{{ setup_data.url }}"
  license: "{{ setup_data.license }}"
  summary: "H2O4GPU is a collection of GPU solvers by H2O.ai with APIs in Python and R."
  doc_url: https://github.com/h2oai/h2o4gpu/blob/master/README.md
  dev_url: https://github.com/h2oai/h2o4gpu

extra:
  maintainers:
    - h2oai


